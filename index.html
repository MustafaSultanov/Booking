<!DOCTYPE html>
<html lang="ky">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–í–∞–ª–µ–π–±–æ–ª –ó–∞–ª—ã - –ñ—É–º–∞–ª—ã–∫ –ë—Ä–æ–Ω–¥–æ–æ</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
					sans-serif;
				background: #f8fafc;
				min-height: 100vh;
				padding: 20px;
				color: #1e293b;
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
			}

			.header {
				background: white;
				border-radius: 16px;
				padding: 32px;
				margin-bottom: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-wrap: wrap;
				gap: 16px;
			}

			.header-left h1 {
				font-size: 32px;
				font-weight: 600;
				color: #0f172a;
				margin-bottom: 8px;
			}

			.subtitle {
				color: #64748b;
				font-size: 16px;
			}

			.header-actions {
				display: flex;
				gap: 12px;
			}

			.sync-btn {
				background: #2563eb;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 8px;
				cursor: pointer;
				font-weight: 500;
				transition: all 0.2s;
				font-size: 14px;
			}

			.sync-btn:hover {
				background: #1d4ed8;
			}

			.sync-btn.share {
				background: #16a34a;
			}

			.sync-btn.share:hover {
				background: #15803d;
			}

			.week-nav {
				display: flex;
				justify-content: space-between;
				align-items: center;
				background: white;
				border-radius: 12px;
				padding: 20px 24px;
				margin-bottom: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.nav-btn {
				background: #f1f5f9;
				border: none;
				padding: 10px 20px;
				border-radius: 8px;
				cursor: pointer;
				font-weight: 500;
				color: #475569;
				transition: all 0.2s;
			}

			.nav-btn:hover {
				background: #e2e8f0;
				color: #1e293b;
			}

			.week-info {
				font-size: 18px;
				font-weight: 600;
				color: #0f172a;
			}

			.stats-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
				gap: 16px;
				margin-bottom: 24px;
			}

			.stat-card {
				background: white;
				border-radius: 12px;
				padding: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.stat-label {
				font-size: 14px;
				color: #64748b;
				margin-bottom: 8px;
				font-weight: 500;
			}

			.stat-value {
				font-size: 32px;
				font-weight: 700;
				margin-bottom: 4px;
			}

			.stat-card.booked .stat-value {
				color: #dc2626;
			}
			.stat-card.available .stat-value {
				color: #16a34a;
			}
			.stat-card.past .stat-value {
				color: #ca8a04;
			}
			.stat-card.total .stat-value {
				color: #2563eb;
			}

			.days-grid {
				display: grid;
				gap: 16px;
			}

			.day-card {
				background: white;
				border-radius: 12px;
				padding: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.day-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
				padding-bottom: 16px;
				border-bottom: 2px solid #f1f5f9;
			}

			.day-title {
				font-size: 20px;
				font-weight: 600;
				color: #0f172a;
			}

			.day-date {
				font-size: 14px;
				color: #64748b;
			}

			.day-stats {
				display: flex;
				gap: 24px;
				font-size: 13px;
				color: #64748b;
			}

			.day-stat {
				display: flex;
				align-items: center;
				gap: 6px;
			}

			.stat-dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
			}

			.stat-dot.booked {
				background: #dc2626;
			}
			.stat-dot.available {
				background: #16a34a;
			}
			.stat-dot.past {
				background: #ca8a04;
			}

			.time-slots {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
				gap: 8px;
			}

			.time-slot {
				padding: 12px 8px;
				border-radius: 8px;
				text-align: center;
				font-size: 14px;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.15s;
				border: 2px solid transparent;
			}

			.time-slot:hover:not(.past):not(.booked) {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			}

			.time-slot.available {
				background: #f0fdf4;
				color: #166534;
				border-color: #bbf7d0;
			}

			.time-slot.available:hover {
				background: #dcfce7;
				border-color: #86efac;
			}

			.time-slot.booked {
				background: #fef2f2;
				color: #991b1b;
				border-color: #fecaca;
				cursor: not-allowed;
			}

			.time-slot.past {
				background: #fefce8;
				color: #854d0e;
				border-color: #fef08a;
				cursor: not-allowed;
				opacity: 0.6;
			}

			.modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.4);
				z-index: 1000;
				justify-content: center;
				align-items: center;
				backdrop-filter: blur(4px);
			}

			.modal.active {
				display: flex;
			}

			.modal-content {
				background: white;
				padding: 32px;
				border-radius: 16px;
				max-width: 500px;
				width: 90%;
				box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
				max-height: 90vh;
				overflow-y: auto;
			}

			.modal-content h2 {
				font-size: 24px;
				margin-bottom: 16px;
				color: #0f172a;
				font-weight: 600;
			}

			.modal-content p {
				color: #64748b;
				margin-bottom: 24px;
				font-size: 15px;
			}

			.modal-buttons {
				display: flex;
				gap: 12px;
			}

			.modal-btn {
				flex: 1;
				padding: 12px 24px;
				border: none;
				border-radius: 8px;
				font-size: 15px;
				cursor: pointer;
				font-weight: 600;
				transition: all 0.2s;
			}

			.modal-btn:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.modal-btn.confirm {
				background: #16a34a;
				color: white;
			}

			.modal-btn.confirm:hover:not(:disabled) {
				background: #15803d;
			}

			.modal-btn.cancel {
				background: #f1f5f9;
				color: #475569;
			}

			.modal-btn.cancel:hover {
				background: #e2e8f0;
			}

			.sync-link {
				background: #f1f5f9;
				padding: 16px;
				border-radius: 8px;
				word-break: break-all;
				font-family: monospace;
				font-size: 12px;
				margin: 16px 0;
			}

			.copy-btn {
				width: 100%;
				background: #2563eb;
				color: white;
				border: none;
				padding: 12px;
				border-radius: 8px;
				cursor: pointer;
				font-weight: 600;
				margin-top: 12px;
			}

			.copy-btn:hover {
				background: #1d4ed8;
			}

			.info-box {
				background: #eff6ff;
				border: 1px solid #bfdbfe;
				color: #1e40af;
				padding: 16px;
				border-radius: 8px;
				margin: 16px 0;
				font-size: 14px;
			}

			.booked-section {
				background: white;
				border-radius: 12px;
				padding: 24px;
				margin-top: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.booked-section h2 {
				font-size: 20px;
				font-weight: 600;
				margin-bottom: 16px;
				color: #0f172a;
			}

			.booked-list {
				display: grid;
				gap: 8px;
			}

			.booked-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 16px;
				background: #fef2f2;
				border-radius: 8px;
				border-left: 3px solid #dc2626;
			}

			.booked-info {
				flex: 1;
			}

			.booked-time {
				font-weight: 600;
				color: #0f172a;
				margin-bottom: 4px;
			}

			.booked-date {
				font-size: 13px;
				color: #64748b;
			}

			.cancel-btn {
				background: #dc2626;
				color: white;
				border: none;
				padding: 8px 16px;
				border-radius: 6px;
				cursor: pointer;
				font-weight: 500;
				font-size: 13px;
				transition: background 0.2s;
			}

			.cancel-btn:hover {
				background: #b91c1c;
			}

			.empty-state {
				text-align: center;
				padding: 40px;
				color: #94a3b8;
			}

			@media (max-width: 768px) {
				.container {
					padding: 0;
				}

				.header {
					padding: 24px;
				}

				.header-left h1 {
					font-size: 24px;
				}

				.header-actions {
					width: 100%;
				}

				.sync-btn {
					flex: 1;
				}

				.stats-grid {
					grid-template-columns: repeat(2, 1fr);
				}

				.time-slots {
					grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
				}

				.day-stats {
					flex-direction: column;
					gap: 8px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<div class="header-left">
					<h1>üèê –í–∞–ª–µ–π–±–æ–ª –ó–∞–ª—ã</h1>
					<p class="subtitle">–ñ—É–º–∞–ª—ã–∫ –±—Ä–æ–Ω–¥–æ–æ —Å–∏—Å—Ç–µ–º–∞—Å—ã</p>
				</div>
				<div class="header-actions">
					<button class="sync-btn share" onclick="shareData()">
						üì§ –ë”©–ª“Ø—à“Ø“Ø
					</button>
					<button class="sync-btn" onclick="loadFromLink()">üì• –ñ“Ø–∫—Ç”©”©</button>
				</div>
			</div>

			<div class="week-nav">
				<button class="nav-btn" onclick="changeWeek(-1)">‚Üê –ú—É—Ä—É–Ω–∫—É –∂—É–º–∞</button>
				<div class="week-info" id="weekInfo"></div>
				<button class="nav-btn" onclick="changeWeek(1)">–ö–∏–π–∏–Ω–∫–∏ –∂—É–º–∞ ‚Üí</button>
			</div>

			<div class="stats-grid" id="statsGrid"></div>
			<div class="days-grid" id="daysGrid"></div>

			<div class="booked-section">
				<h2>–ë–∞—Ä–¥—ã–∫ –±—Ä–æ–Ω–¥–æ–ª–≥–æ–Ω —Å–∞–∞—Ç–∞—Ä</h2>
				<div class="booked-list" id="bookedList"></div>
			</div>
		</div>

		<div class="modal" id="bookingModal">
			<div class="modal-content">
				<h2>–ë—Ä–æ–Ω–¥–æ–æ</h2>
				<p id="modalText"></p>
				<div class="modal-buttons">
					<button
						class="modal-btn confirm"
						id="confirmBtn"
						onclick="confirmBooking()">
						–ë—Ä–æ–Ω–¥–æ–æ
					</button>
					<button class="modal-btn cancel" onclick="closeModal()">
						–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É
					</button>
				</div>
			</div>
		</div>

		<div class="modal" id="shareModal">
			<div class="modal-content">
				<h2>üì§ –ú–∞–∞–ª—ã–º–∞—Ç—Ç—ã –±”©–ª“Ø—à“Ø“Ø</h2>
				<p>–ë—É–ª —à–∏–ª—Ç–µ–º–µ–Ω–∏ –±–∞—à–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–≥–æ –∂”©–Ω”©—Ç“Ø“£“Ø–∑ –∂–µ –∫”©—á“Ø—Ä“Ø–ø –∞–ª—ã“£—ã–∑:</p>
				<div class="sync-link" id="shareLink"></div>
				<button class="copy-btn" onclick="copyLink()">–®–∏–ª—Ç–µ–º–µ–Ω–∏ –∫”©—á“Ø—Ä“Ø“Ø</button>
				<div class="info-box">
					üí° –ë–∞—à–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–¥–æ –±—É–ª —Å–∞–π—Ç—Ç—ã –∞—á—ã–ø, "üì• –ñ“Ø–∫—Ç”©”©" –±–∞—Å–∫—ã—á—ã–Ω –±–∞—Å—ã–ø,
					—à–∏–ª—Ç–µ–º–µ–Ω–∏ –∫–∏—Ä–≥–∏–∑–∏“£–∏–∑
				</div>
				<div class="modal-buttons">
					<button class="modal-btn cancel" onclick="closeShareModal()">
						–ñ–∞–±—É—É
					</button>
				</div>
			</div>
		</div>

		<div class="modal" id="loadModal">
			<div class="modal-content">
				<h2>üì• –ú–∞–∞–ª—ã–º–∞—Ç—Ç—ã –∂“Ø–∫—Ç”©”©</h2>
				<p>–®–∏–ª—Ç–µ–º–µ–Ω–∏ –∂–µ –∫–æ–¥–¥—É –∫–∏—Ä–≥–∏–∑–∏“£–∏–∑:</p>
				<textarea
					id="loadInput"
					style="
						width: 100%;
						min-height: 100px;
						padding: 12px;
						border: 2px solid #e2e8f0;
						border-radius: 8px;
						font-family: monospace;
						font-size: 12px;
						margin: 16px 0;
					"></textarea>
				<div class="info-box">
					‚ö†Ô∏è –£—á—É—Ä: –ñ“Ø–∫—Ç”©–≥”©–Ω–¥”©–Ω –∫–∏–π–∏–Ω —É—á—É—Ä–¥–∞–≥—ã –º–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä –∞–ª–º–∞—à—Ç—ã—Ä—ã–ª–∞—Ç
				</div>
				<div class="modal-buttons">
					<button class="modal-btn confirm" onclick="confirmLoad()">
						–ñ“Ø–∫—Ç”©”©
					</button>
					<button class="modal-btn cancel" onclick="closeLoadModal()">
						–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É
					</button>
				</div>
			</div>
		</div>

		<script>
			const STORAGE_KEY = "volleyball_bookings_v2";

			let bookedSlots = [];
			let selectedSlot = null;
			let currentWeekOffset = 0;
			let nextId = 1;

			const dayNames = [
				"–î“Ø–π—à”©–º–±“Ø",
				"–®–µ–π—à–µ–º–±–∏",
				"–®–∞—Ä—à–µ–º–±–∏",
				"–ë–µ–π—à–µ–º–±–∏",
				"–ñ—É–º–∞",
				"–ò—à–µ–º–±–∏",
				"–ñ–µ–∫—à–µ–º–±–∏",
			];

			// LocalStorage'–¥–µ–Ω –∂“Ø–∫—Ç”©”©
			function loadBookings() {
				try {
					const saved = localStorage.getItem(STORAGE_KEY);
					if (saved) {
						const data = JSON.parse(saved);
						bookedSlots = data.bookings || [];
						nextId = data.nextId || 1;
					}
				} catch (error) {
					console.error("–ñ“Ø–∫—Ç”©”© –∫–∞—Ç–∞—Å—ã:", error);
				}
			}

			// LocalStorage'–≥–µ —Å–∞–∫—Ç–æ–æ
			function saveBookings() {
				try {
					const data = {
						bookings: bookedSlots,
						nextId: nextId,
						lastUpdated: new Date().toISOString(),
					};
					localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
				} catch (error) {
					console.error("–°–∞–∫—Ç–æ–æ –∫–∞—Ç–∞—Å—ã:", error);
				}
			}

			// –ú–∞–∞–ª—ã–º–∞—Ç—Ç—ã –±”©–ª“Ø—à“Ø“Ø
			function shareData() {
				const data = {
					bookings: bookedSlots,
					nextId: nextId,
					version: 2,
				};
				const encoded = btoa(encodeURIComponent(JSON.stringify(data)));
				const link = window.location.href.split("?")[0] + "?data=" + encoded;

				document.getElementById("shareLink").textContent = link;
				document.getElementById("shareModal").classList.add("active");
			}

			function closeShareModal() {
				document.getElementById("shareModal").classList.remove("active");
			}

			function copyLink() {
				const link = document.getElementById("shareLink").textContent;
				navigator.clipboard
					.writeText(link)
					.then(() => {
						alert("–®–∏–ª—Ç–µ–º–µ –∫”©—á“Ø—Ä“Ø–ª–¥“Ø! ‚úì");
					})
					.catch(() => {
						// Fallback
						const textarea = document.createElement("textarea");
						textarea.value = link;
						document.body.appendChild(textarea);
						textarea.select();
						document.execCommand("copy");
						document.body.removeChild(textarea);
						alert("–®–∏–ª—Ç–µ–º–µ –∫”©—á“Ø—Ä“Ø–ª–¥“Ø! ‚úì");
					});
			}

			// –®–∏–ª—Ç–µ–º–µ–¥–µ–Ω –∂“Ø–∫—Ç”©”©
			function loadFromLink() {
				document.getElementById("loadModal").classList.add("active");
			}

			function closeLoadModal() {
				document.getElementById("loadModal").classList.remove("active");
				document.getElementById("loadInput").value = "";
			}

			function confirmLoad() {
				try {
					const input = document.getElementById("loadInput").value.trim();
					let data;

					// URL'–¥–µ–Ω data –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–Ω –∞–ª—É—É
					if (input.includes("?data=")) {
						const urlData = input.split("?data=")[1];
						data = JSON.parse(decodeURIComponent(atob(urlData)));
					} else {
						// –¢“Ø–∑ –∫–æ–¥–¥—É –∂“Ø–∫—Ç”©”©
						data = JSON.parse(decodeURIComponent(atob(input)));
					}

					if (data.bookings && data.nextId) {
						bookedSlots = data.bookings;
						nextId = data.nextId;
						saveBookings();
						render();
						closeLoadModal();
						alert("–ú–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä –∂“Ø–∫—Ç”©–ª–¥“Ø! ‚úì");
					} else {
						alert("–ö–∞—Ç–∞: –¢—É—É—Ä–∞ —ç–º–µ—Å —Ñ–æ—Ä–º–∞—Ç");
					}
				} catch (error) {
					console.error("–ñ“Ø–∫—Ç”©”© –∫–∞—Ç–∞—Å—ã:", error);
					alert(
						"–ö–∞—Ç–∞: –ú–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä–¥—ã –∂“Ø–∫—Ç”©”© –º“Ø–º–∫“Ø–Ω —ç–º–µ—Å. –®–∏–ª—Ç–µ–º–µ —Ç—É—É—Ä–∞ —ç–∫–µ–Ω–∏–Ω —Ç–µ–∫—à–µ—Ä–∏“£–∏–∑."
					);
				}
			}

			// URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç—Ç—ã–∫ –∂“Ø–∫—Ç”©”©
			function checkUrlData() {
				const urlParams = new URLSearchParams(window.location.search);
				const dataParam = urlParams.get("data");

				if (dataParam) {
					try {
						const data = JSON.parse(decodeURIComponent(atob(dataParam)));
						if (data.bookings && data.nextId) {
							if (confirm("–ñ–∞“£—ã –º–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä —Ç–∞–±—ã–ª–¥—ã. –ñ“Ø–∫—Ç”©–≥”©–Ω–≥”© –º–∞–∫—É–ª—Å—É–∑–±—É?")) {
								bookedSlots = data.bookings;
								nextId = data.nextId;
								saveBookings();
								// URL'–¥—É —Ç–∞–∑–∞–ª–æ–æ
								window.history.replaceState(
									{},
									document.title,
									window.location.pathname
								);
							}
						}
					} catch (error) {
						console.error("URL –º–∞–∞–ª—ã–º–∞—Ç—Ç–∞—Ä—ã–Ω –∂“Ø–∫—Ç”©”© –∫–∞—Ç–∞—Å—ã:", error);
					}
				}
			}

			function getWeekDates(offset = 0) {
				const today = new Date();
				const currentDay = today.getDay();
				const monday = new Date(today);
				monday.setDate(
					today.getDate() - (currentDay === 0 ? 6 : currentDay - 1) + offset * 7
				);

				const dates = [];
				for (let i = 0; i < 7; i++) {
					const date = new Date(monday);
					date.setDate(monday.getDate() + i);
					dates.push(date);
				}
				return dates;
			}

			function formatDate(date) {
				const day = date.getDate().toString().padStart(2, "0");
				const month = (date.getMonth() + 1).toString().padStart(2, "0");
				return `${day}.${month}`;
			}

			function getDateKey(date) {
				return `${date.getFullYear()}-${(date.getMonth() + 1)
					.toString()
					.padStart(2, "0")}-${date.getDate().toString().padStart(2, "0")}`;
			}

			function updateWeekInfo() {
				const dates = getWeekDates(currentWeekOffset);
				const start = formatDate(dates[0]);
				const end = formatDate(dates[6]);
				document.getElementById("weekInfo").textContent = `${start} - ${end}`;
			}

			function changeWeek(direction) {
				currentWeekOffset += direction;
				render();
			}

			function calculateStats() {
				const dates = getWeekDates(currentWeekOffset);
				const now = new Date();
				let totalSlots = 0;
				let bookedCount = 0;
				let pastCount = 0;
				let availableCount = 0;

				dates.forEach((date) => {
					const dateKey = getDateKey(date);
					for (let hour = 9; hour < 24; hour++) {
						totalSlots++;
						const slotDate = new Date(date);
						slotDate.setHours(hour, 0, 0, 0);

						const isPast = slotDate < now;
						const isBooked = bookedSlots.some(
							(slot) =>
								slot.date === dateKey && hour >= slot.start && hour < slot.end
						);

						if (isPast && !isBooked) {
							pastCount++;
						} else if (isBooked) {
							bookedCount++;
						} else {
							availableCount++;
						}
					}
				});

				return { totalSlots, bookedCount, pastCount, availableCount };
			}

			function renderStats() {
				const stats = calculateStats();
				const grid = document.getElementById("statsGrid");

				grid.innerHTML = `
                <div class="stat-card total">
                    <div class="stat-label">–ñ–∞–ª–ø—ã —Å–∞–∞—Ç–∞—Ä</div>
                    <div class="stat-value">${stats.totalSlots}</div>
                </div>
                <div class="stat-card booked">
                    <div class="stat-label">–ë—Ä–æ–Ω–¥–æ–ª–≥–æ–Ω</div>
                    <div class="stat-value">${stats.bookedCount}</div>
                </div>
                <div class="stat-card available">
                    <div class="stat-label">–ë–æ—à</div>
                    <div class="stat-value">${stats.availableCount}</div>
                </div>
                <div class="stat-card past">
                    <div class="stat-label">”®—Ç–∫”©–Ω</div>
                    <div class="stat-value">${stats.pastCount}</div>
                </div>
            `;
			}

			function renderDays() {
				const dates = getWeekDates(currentWeekOffset);
				const grid = document.getElementById("daysGrid");
				const now = new Date();

				grid.innerHTML = "";

				dates.forEach((date, index) => {
					const dateKey = getDateKey(date);
					const dayCard = document.createElement("div");
					dayCard.className = "day-card";

					let dayBookedCount = 0;
					let dayAvailableCount = 0;
					let dayPastCount = 0;

					const slotsHTML = [];
					for (let hour = 9; hour < 24; hour++) {
						const slotDate = new Date(date);
						slotDate.setHours(hour, 0, 0, 0);

						const startTime = `${hour.toString().padStart(2, "0")}:00`;

						const isPast = slotDate < now;
						const isBooked = bookedSlots.some(
							(slot) =>
								slot.date === dateKey && hour >= slot.start && hour < slot.end
						);

						let className = "time-slot ";
						if (isPast && !isBooked) {
							className += "past";
							dayPastCount++;
						} else if (isBooked) {
							className += "booked";
							dayBookedCount++;
						} else {
							className += "available";
							dayAvailableCount++;
						}

						const onclick =
							!isPast && !isBooked
								? `onclick="openBookingModal('${dateKey}', ${hour})"`
								: "";

						slotsHTML.push(`
                        <div class="${className}" ${onclick}>
                            ${startTime}
                        </div>
                    `);
					}

					dayCard.innerHTML = `
                    <div class="day-header">
                        <div>
                            <div class="day-title">${dayNames[index]}</div>
                            <div class="day-date">${formatDate(date)}</div>
                        </div>
                        <div class="day-stats">
                            <div class="day-stat">
                                <div class="stat-dot booked"></div>
                                <span>${dayBookedCount}</span>
                            </div>
                            <div class="day-stat">
                                <div class="stat-dot available"></div>
                                <span>${dayAvailableCount}</span>
                            </div>
                            <div class="day-stat">
                                <div class="stat-dot past"></div>
                                <span>${dayPastCount}</span>
                            </div>
                        </div>
                    </div>
                    <div class="time-slots">
                        ${slotsHTML.join("")}
                    </div>
                `;

					grid.appendChild(dayCard);
				});
			}

			function openBookingModal(dateKey, hour) {
				selectedSlot = { date: dateKey, hour };
				const startTime = `${hour.toString().padStart(2, "0")}:00`;
				const endTime = `${(hour + 1).toString().padStart(2, "0")}:00`;

				const date = new Date(dateKey);
				const dayName = dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1];

				document.getElementById(
					"modalText"
				).textContent = `${dayName}, ${formatDate(
					date
				)} - ${startTime}-${endTime} –±—Ä–æ–Ω–¥–æ–≥–æ–Ω–≥—É –∫–µ–ª–µ—Å–∏–∑–±–∏?`;
				document.getElementById("bookingModal").classList.add("active");
			}

			function closeModal() {
				document.getElementById("bookingModal").classList.remove("active");
				selectedSlot = null;
			}

			function confirmBooking() {
				if (selectedSlot) {
					const newBooking = {
						id: nextId++,
						date: selectedSlot.date,
						start: selectedSlot.hour,
						end: selectedSlot.hour + 1,
						created_at: new Date().toISOString(),
					};

					bookedSlots.push(newBooking);
					saveBookings();
					closeModal();
					render();
				}
			}

			function cancelBooking(id) {
				if (confirm("–ë—É–ª –±—Ä–æ–Ω–¥–æ–æ–Ω—É –∂–æ–∫–∫–æ —á—ã–≥–∞—Ä–∞—Å—ã–∑–±—ã?")) {
					bookedSlots = bookedSlots.filter((slot) => slot.id !== id);
					saveBookings();
					render();
				}
			}

			function renderBookedList() {
				const list = document.getElementById("bookedList");

				if (bookedSlots.length === 0) {
					list.innerHTML =
						'<div class="empty-state">–ë—Ä–æ–Ω–¥–æ–ª–≥–æ–Ω —Å–∞–∞—Ç–∞—Ä –∂–æ–∫</div>';
					return;
				}

				const sortedBookings = [...bookedSlots].sort((a, b) => {
					if (a.date !== b.date) return a.date.localeCompare(b.date);
					return a.start - b.start;
				});

				list.innerHTML = sortedBookings
					.map((slot) => {
						const date = new Date(slot.date);
						const dayName =
							dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1];
						const startTime = `${slot.start.toString().padStart(2, "0")}:00`;
						const endTime = `${slot.end.toString().padStart(2, "0")}:00`;

						return `
                    <div class="booked-item">
                        <div class="booked-info">
                            <div class="booked-time">${startTime} - ${endTime}</div>
                            <div class="booked-date">${dayName}, ${formatDate(
							date
						)}</div>
                        </div>
                        <button class="cancel-btn" onclick="cancelBooking(${
													slot.id
												})">
                            –ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É
                        </button>
                    </div>
                `;
					})
					.join("");
			}

			function render() {
				updateWeekInfo();
				renderStats();
				renderDays();
				renderBookedList();
			}

			// –ê—Ä 30 —Å–µ–∫—É–Ω–¥–∞–¥–∞ –∂–∞“£—ã—Ä—Ç—É—É
			setInterval(render, 30000);

			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
			loadBookings();
			checkUrlData();
			render();
		</script>
	</body>
</html>
