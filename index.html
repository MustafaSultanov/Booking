<!DOCTYPE html>
<html lang="ky">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–í–∞–ª–µ–π–±–æ–ª –ó–∞–ª—ã - –ñ—É–º–∞–ª—ã–∫ –ë—Ä–æ–Ω–¥–æ–æ</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
					sans-serif;
				background: #f8fafc;
				min-height: 100vh;
				padding: 20px;
				color: #1e293b;
			}

			.container {
				max-width: 1400px;
				margin: 0 auto;
			}

			.header {
				background: white;
				border-radius: 16px;
				padding: 32px;
				margin-bottom: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.header-left h1 {
				font-size: 32px;
				font-weight: 600;
				color: #0f172a;
				margin-bottom: 8px;
			}

			.subtitle {
				color: #64748b;
				font-size: 16px;
			}

			.sync-status {
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 14px;
				color: #64748b;
				padding: 8px 16px;
				background: #f1f5f9;
				border-radius: 8px;
			}

			.sync-dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
				background: #16a34a;
				animation: pulse 2s infinite;
			}

			@keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.5;
				}
			}

			.week-nav {
				display: flex;
				justify-content: space-between;
				align-items: center;
				background: white;
				border-radius: 12px;
				padding: 20px 24px;
				margin-bottom: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.nav-btn {
				background: #f1f5f9;
				border: none;
				padding: 10px 20px;
				border-radius: 8px;
				cursor: pointer;
				font-weight: 500;
				color: #475569;
				transition: all 0.2s;
			}

			.nav-btn:hover {
				background: #e2e8f0;
				color: #1e293b;
			}

			.week-info {
				font-size: 18px;
				font-weight: 600;
				color: #0f172a;
			}

			.stats-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
				gap: 16px;
				margin-bottom: 24px;
			}

			.stat-card {
				background: white;
				border-radius: 12px;
				padding: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.stat-label {
				font-size: 14px;
				color: #64748b;
				margin-bottom: 8px;
				font-weight: 500;
			}

			.stat-value {
				font-size: 32px;
				font-weight: 700;
				margin-bottom: 4px;
			}

			.stat-card.booked .stat-value {
				color: #dc2626;
			}
			.stat-card.available .stat-value {
				color: #16a34a;
			}
			.stat-card.past .stat-value {
				color: #ca8a04;
			}
			.stat-card.total .stat-value {
				color: #2563eb;
			}

			.days-grid {
				display: grid;
				gap: 16px;
			}

			.day-card {
				background: white;
				border-radius: 12px;
				padding: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.day-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
				padding-bottom: 16px;
				border-bottom: 2px solid #f1f5f9;
			}

			.day-title {
				font-size: 20px;
				font-weight: 600;
				color: #0f172a;
			}

			.day-date {
				font-size: 14px;
				color: #64748b;
			}

			.day-stats {
				display: flex;
				gap: 24px;
				font-size: 13px;
				color: #64748b;
			}

			.day-stat {
				display: flex;
				align-items: center;
				gap: 6px;
			}

			.stat-dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
			}

			.stat-dot.booked {
				background: #dc2626;
			}
			.stat-dot.available {
				background: #16a34a;
			}
			.stat-dot.past {
				background: #ca8a04;
			}

			.time-slots {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
				gap: 8px;
			}

			.time-slot {
				padding: 12px 8px;
				border-radius: 8px;
				text-align: center;
				font-size: 14px;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.15s;
				border: 2px solid transparent;
			}

			.time-slot:hover:not(.past):not(.booked) {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			}

			.time-slot.available {
				background: #f0fdf4;
				color: #166534;
				border-color: #bbf7d0;
			}

			.time-slot.available:hover {
				background: #dcfce7;
				border-color: #86efac;
			}

			.time-slot.booked {
				background: #fef2f2;
				color: #991b1b;
				border-color: #fecaca;
				cursor: not-allowed;
			}

			.time-slot.past {
				background: #fefce8;
				color: #854d0e;
				border-color: #fef08a;
				cursor: not-allowed;
				opacity: 0.6;
			}

			.modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.4);
				z-index: 1000;
				justify-content: center;
				align-items: center;
				backdrop-filter: blur(4px);
			}

			.modal.active {
				display: flex;
			}

			.modal-content {
				background: white;
				padding: 32px;
				border-radius: 16px;
				max-width: 400px;
				width: 90%;
				box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
			}

			.modal-content h2 {
				font-size: 24px;
				margin-bottom: 16px;
				color: #0f172a;
				font-weight: 600;
			}

			.modal-content p {
				color: #64748b;
				margin-bottom: 24px;
				font-size: 15px;
			}

			.modal-buttons {
				display: flex;
				gap: 12px;
			}

			.modal-btn {
				flex: 1;
				padding: 12px 24px;
				border: none;
				border-radius: 8px;
				font-size: 15px;
				cursor: pointer;
				font-weight: 600;
				transition: all 0.2s;
			}

			.modal-btn.confirm {
				background: #16a34a;
				color: white;
			}

			.modal-btn.confirm:hover {
				background: #15803d;
			}

			.modal-btn.cancel {
				background: #f1f5f9;
				color: #475569;
			}

			.modal-btn.cancel:hover {
				background: #e2e8f0;
			}

			.booked-section {
				background: white;
				border-radius: 12px;
				padding: 24px;
				margin-top: 24px;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.booked-section h2 {
				font-size: 20px;
				font-weight: 600;
				margin-bottom: 16px;
				color: #0f172a;
			}

			.booked-list {
				display: grid;
				gap: 8px;
			}

			.booked-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 16px;
				background: #fef2f2;
				border-radius: 8px;
				border-left: 3px solid #dc2626;
			}

			.booked-info {
				flex: 1;
			}

			.booked-time {
				font-weight: 600;
				color: #0f172a;
				margin-bottom: 4px;
			}

			.booked-date {
				font-size: 13px;
				color: #64748b;
			}

			.cancel-btn {
				background: #dc2626;
				color: white;
				border: none;
				padding: 8px 16px;
				border-radius: 6px;
				cursor: pointer;
				font-weight: 500;
				font-size: 13px;
				transition: background 0.2s;
			}

			.cancel-btn:hover {
				background: #b91c1c;
			}

			.empty-state {
				text-align: center;
				padding: 40px;
				color: #94a3b8;
			}

			@media (max-width: 768px) {
				.container {
					padding: 0;
				}

				.header {
					padding: 24px;
					flex-direction: column;
					gap: 16px;
					align-items: flex-start;
				}

				h1 {
					font-size: 24px;
				}

				.stats-grid {
					grid-template-columns: repeat(2, 1fr);
				}

				.time-slots {
					grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
				}

				.day-stats {
					flex-direction: column;
					gap: 8px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<div class="header-left">
					<h1>üèê –í–∞–ª–µ–π–±–æ–ª –ó–∞–ª—ã</h1>
					<p class="subtitle">–ñ—É–º–∞–ª—ã–∫ –±—Ä–æ–Ω–¥–æ–æ —Å–∏—Å—Ç–µ–º–∞—Å—ã</p>
				</div>
				<div class="sync-status">
					<div class="sync-dot"></div>
					<span>–°–∞–∫—Ç–∞–ª–¥—ã</span>
				</div>
			</div>

			<div class="week-nav">
				<button class="nav-btn" onclick="changeWeek(-1)">‚Üê –ú—É—Ä—É–Ω–∫—É –∂—É–º–∞</button>
				<div class="week-info" id="weekInfo"></div>
				<button class="nav-btn" onclick="changeWeek(1)">–ö–∏–π–∏–Ω–∫–∏ –∂—É–º–∞ ‚Üí</button>
			</div>

			<div class="stats-grid" id="statsGrid"></div>
			<div class="days-grid" id="daysGrid"></div>

			<div class="booked-section">
				<h2>–ë–∞—Ä–¥—ã–∫ –±—Ä–æ–Ω–¥–æ–ª–≥–æ–Ω —Å–∞–∞—Ç–∞—Ä</h2>
				<div class="booked-list" id="bookedList"></div>
			</div>
		</div>

		<div class="modal" id="bookingModal">
			<div class="modal-content">
				<h2>–ë—Ä–æ–Ω–¥–æ–æ</h2>
				<p id="modalText"></p>
				<div class="modal-buttons">
					<button class="modal-btn confirm" onclick="confirmBooking()">
						–ë—Ä–æ–Ω–¥–æ–æ
					</button>
					<button class="modal-btn cancel" onclick="closeModal()">
						–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É
					</button>
				</div>
			</div>
		</div>

		<script>
			// LocalStorage –º–µ–Ω–µ–Ω —Ç—É—Ä—É–∫—Ç—É—É —Å–∞–∫—Ç–æ–æ
			const STORAGE_KEY = "volleyball_bookings_v1";

			let bookedSlots = [];
			let selectedSlot = null;
			let currentWeekOffset = 0;
			let nextId = 1;

			const dayNames = [
				"–î“Ø–π—à”©–º–±“Ø",
				"–®–µ–π—à–µ–º–±–∏",
				"–®–∞—Ä—à–µ–º–±–∏",
				"–ë–µ–π—à–µ–º–±–∏",
				"–ñ—É–º–∞",
				"–ò—à–µ–º–±–∏",
				"–ñ–µ–∫—à–µ–º–±–∏",
			];

			// LocalStorage'–¥–µ–Ω –∂“Ø–∫—Ç”©”©
			function loadBookings() {
				try {
					const saved = localStorage.getItem(STORAGE_KEY);
					if (saved) {
						const data = JSON.parse(saved);
						bookedSlots = data.bookings || [];
						nextId = data.nextId || 1;
					}
				} catch (error) {
					console.error("–ñ“Ø–∫—Ç”©”©–¥”© –∫–∞—Ç–∞:", error);
					bookedSlots = [];
				}
			}

			// LocalStorage'–≥–µ —Å–∞–∫—Ç–æ–æ
			function saveBookings() {
				try {
					const data = {
						bookings: bookedSlots,
						nextId: nextId,
						lastUpdated: new Date().toISOString(),
					};
					localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
				} catch (error) {
					console.error("–°–∞–∫—Ç–æ–æ–¥–æ –∫–∞—Ç–∞:", error);
				}
			}

			function getWeekDates(offset = 0) {
				const today = new Date();
				const currentDay = today.getDay();
				const monday = new Date(today);
				monday.setDate(
					today.getDate() - (currentDay === 0 ? 6 : currentDay - 1) + offset * 7
				);

				const dates = [];
				for (let i = 0; i < 7; i++) {
					const date = new Date(monday);
					date.setDate(monday.getDate() + i);
					dates.push(date);
				}
				return dates;
			}

			function formatDate(date) {
				const day = date.getDate().toString().padStart(2, "0");
				const month = (date.getMonth() + 1).toString().padStart(2, "0");
				return `${day}.${month}`;
			}

			function getDateKey(date) {
				return `${date.getFullYear()}-${(date.getMonth() + 1)
					.toString()
					.padStart(2, "0")}-${date.getDate().toString().padStart(2, "0")}`;
			}

			function updateWeekInfo() {
				const dates = getWeekDates(currentWeekOffset);
				const start = formatDate(dates[0]);
				const end = formatDate(dates[6]);
				document.getElementById("weekInfo").textContent = `${start} - ${end}`;
			}

			function changeWeek(direction) {
				currentWeekOffset += direction;
				render();
			}

			function calculateStats() {
				const dates = getWeekDates(currentWeekOffset);
				const now = new Date();
				let totalSlots = 0;
				let bookedCount = 0;
				let pastCount = 0;
				let availableCount = 0;

				dates.forEach((date) => {
					const dateKey = getDateKey(date);
					for (let hour = 9; hour < 24; hour++) {
						totalSlots++;
						const slotDate = new Date(date);
						slotDate.setHours(hour, 0, 0, 0);

						const isPast = slotDate < now;
						const isBooked = bookedSlots.some(
							(slot) =>
								slot.date === dateKey && hour >= slot.start && hour < slot.end
						);

						if (isPast && !isBooked) {
							pastCount++;
						} else if (isBooked) {
							bookedCount++;
						} else {
							availableCount++;
						}
					}
				});

				return { totalSlots, bookedCount, pastCount, availableCount };
			}

			function renderStats() {
				const stats = calculateStats();
				const grid = document.getElementById("statsGrid");

				grid.innerHTML = `
                <div class="stat-card total">
                    <div class="stat-label">–ñ–∞–ª–ø—ã —Å–∞–∞—Ç–∞—Ä</div>
                    <div class="stat-value">${stats.totalSlots}</div>
                </div>
                <div class="stat-card booked">
                    <div class="stat-label">–ë—Ä–æ–Ω–¥–æ–ª–≥–æ–Ω</div>
                    <div class="stat-value">${stats.bookedCount}</div>
                </div>
                <div class="stat-card available">
                    <div class="stat-label">–ë–æ—à</div>
                    <div class="stat-value">${stats.availableCount}</div>
                </div>
                <div class="stat-card past">
                    <div class="stat-label">”®—Ç–∫”©–Ω</div>
                    <div class="stat-value">${stats.pastCount}</div>
                </div>
            `;
			}

			function renderDays() {
				const dates = getWeekDates(currentWeekOffset);
				const grid = document.getElementById("daysGrid");
				const now = new Date();

				grid.innerHTML = "";

				dates.forEach((date, index) => {
					const dateKey = getDateKey(date);
					const dayCard = document.createElement("div");
					dayCard.className = "day-card";

					let dayBookedCount = 0;
					let dayAvailableCount = 0;
					let dayPastCount = 0;

					const slotsHTML = [];
					for (let hour = 9; hour < 24; hour++) {
						const slotDate = new Date(date);
						slotDate.setHours(hour, 0, 0, 0);

						const startTime = `${hour.toString().padStart(2, "0")}:00`;

						const isPast = slotDate < now;
						const isBooked = bookedSlots.some(
							(slot) =>
								slot.date === dateKey && hour >= slot.start && hour < slot.end
						);

						let className = "time-slot ";
						if (isPast && !isBooked) {
							className += "past";
							dayPastCount++;
						} else if (isBooked) {
							className += "booked";
							dayBookedCount++;
						} else {
							className += "available";
							dayAvailableCount++;
						}

						const onclick =
							!isPast && !isBooked
								? `onclick="openBookingModal('${dateKey}', ${hour})"`
								: "";

						slotsHTML.push(`
                        <div class="${className}" ${onclick}>
                            ${startTime}
                        </div>
                    `);
					}

					dayCard.innerHTML = `
                    <div class="day-header">
                        <div>
                            <div class="day-title">${dayNames[index]}</div>
                            <div class="day-date">${formatDate(date)}</div>
                        </div>
                        <div class="day-stats">
                            <div class="day-stat">
                                <div class="stat-dot booked"></div>
                                <span>${dayBookedCount}</span>
                            </div>
                            <div class="day-stat">
                                <div class="stat-dot available"></div>
                                <span>${dayAvailableCount}</span>
                            </div>
                            <div class="day-stat">
                                <div class="stat-dot past"></div>
                                <span>${dayPastCount}</span>
                            </div>
                        </div>
                    </div>
                    <div class="time-slots">
                        ${slotsHTML.join("")}
                    </div>
                `;

					grid.appendChild(dayCard);
				});
			}

			function openBookingModal(dateKey, hour) {
				selectedSlot = { date: dateKey, hour };
				const startTime = `${hour.toString().padStart(2, "0")}:00`;
				const endTime = `${(hour + 1).toString().padStart(2, "0")}:00`;

				const date = new Date(dateKey);
				const dayName = dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1];

				document.getElementById(
					"modalText"
				).textContent = `${dayName}, ${formatDate(
					date
				)} - ${startTime}-${endTime} –±—Ä–æ–Ω–¥–æ–≥–æ–Ω–≥—É –∫–µ–ª–µ—Å–∏–∑–±–∏?`;
				document.getElementById("bookingModal").classList.add("active");
			}

			function closeModal() {
				document.getElementById("bookingModal").classList.remove("active");
				selectedSlot = null;
			}

			function confirmBooking() {
				if (selectedSlot) {
					const newBooking = {
						id: nextId++,
						date: selectedSlot.date,
						start: selectedSlot.hour,
						end: selectedSlot.hour + 1,
						created_at: new Date().toISOString(),
					};

					bookedSlots.push(newBooking);
					saveBookings();
					closeModal();
					render();
				}
			}

			function cancelBooking(id) {
				if (confirm("–ë—É–ª –±—Ä–æ–Ω–¥–æ–æ–Ω—É –∂–æ–∫–∫–æ —á—ã–≥–∞—Ä–∞—Å—ã–∑–±—ã?")) {
					bookedSlots = bookedSlots.filter((slot) => slot.id !== id);
					saveBookings();
					render();
				}
			}

			function renderBookedList() {
				const list = document.getElementById("bookedList");

				if (bookedSlots.length === 0) {
					list.innerHTML =
						'<div class="empty-state">–ë—Ä–æ–Ω–¥–æ–ª–≥–æ–Ω —Å–∞–∞—Ç–∞—Ä –∂–æ–∫</div>';
					return;
				}

				const sortedBookings = [...bookedSlots].sort((a, b) => {
					if (a.date !== b.date) return a.date.localeCompare(b.date);
					return a.start - b.start;
				});

				list.innerHTML = sortedBookings
					.map((slot) => {
						const date = new Date(slot.date);
						const dayName =
							dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1];
						const startTime = `${slot.start.toString().padStart(2, "0")}:00`;
						const endTime = `${slot.end.toString().padStart(2, "0")}:00`;

						return `
                    <div class="booked-item">
                        <div class="booked-info">
                            <div class="booked-time">${startTime} - ${endTime}</div>
                            <div class="booked-date">${dayName}, ${formatDate(
							date
						)}</div>
                        </div>
                        <button class="cancel-btn" onclick="cancelBooking(${
													slot.id
												})">
                            –ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É
                        </button>
                    </div>
                `;
					})
					.join("");
			}

			function render() {
				updateWeekInfo();
				renderStats();
				renderDays();
				renderBookedList();
			}

			// –ê—Ä 30 —Å–µ–∫—É–Ω–¥–∞–¥–∞ –∂–∞“£—ã—Ä—Ç—É—É (—É–±–∞–∫—ã—Ç—Ç—ã–Ω ”©—Ç“Ø—à“Ø “Ø—á“Ø–Ω)
			setInterval(render, 30000);

			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
			loadBookings();
			render();
		</script>
	</body>
</html>
